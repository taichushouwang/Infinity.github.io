title: 前端翻页
categories: html
tags: jQuery html 
date: 2016-04-14 15:35:20
description: 使用了localStorage配合js写了个分页数据和翻页的功能
---
我用了localStorage配合js写了个分页数据和翻页

主要思路：
  1.利用ajax从数据库获取所有数据。
  2.将数据按一定数量分组编号，然后将数据存到localStorage中。 比如content[1], content[2], content[3]...
  3.翻页的时候，就先remove内容，然后再append(localStorage).
缺点就是不能实时更新。一定要刷新。
index.html
```html
    <!doctype html>
    <html>
      <head>
        <title>历史留言</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width initial-scale=0.8 maximum-scale=1.0 user-scalable=yes">
        <link rel="stylesheet" href="/stylesheets/front_wechat/weui.min.css">
        <link rel="stylesheet" href="/stylesheets/front_wechat/base.css">
      </head>
      <body id="historymesPage">
        <div id="content" class="weui_cells">
          <div class="weui_cell">
            <div id="newNote" class="weui_cell_hd">
              <img src="/images/front_wechat/icon/message.jpg">
            </div>
            <div class="weui_cell_bd">
              <h3>历史留言</h3>
            </div>
          </div>
          <div id="messageUl"></div>
          <div class="weui_cell">
            <span class="weui_cell_primary"></span>
            <span>留言总数：</span>
            <span class="totalMessage">-</span>
          </div>
          <div class="weui_cell pageBtn">
            <a href="javascript:;" id="prePage" class="weui_btn weui_btn_plain_default">上一页</a>
            <span id="page">
              <span id="curPage" class="pageNum">1</span>
            </span>
            <a href="javascript:;" id="nextPage" class="weui_btn weui_btn_plain_default">下一页</a>
            <input type="hidden" id="totalPage" value="">
          </div>

        </div>
        <script src="/javascripts/front_wechat/zepto.min.js"></script>
        <script src="/javascripts/front_wechat/test.js"></script>
      </body>
    </html>
```
base.css
```css
  body
  {
    margin-right: 15px;
    margin-left: 15px;
  }
  #newNote img
  {
    width: 28px;
  }
  h3
  {
    color: #da5050;
    margin-left: 15px;
  }
  .liHeader
  {
    font-size: 13px;
    color: #da5050;
    font-weight: bold;
  }
  .liHeader img
  {
    width: 15px;
    vertical-align:text-bottom;
  }
  .liHeader .mesTitle
  {
    color: #000000;
  }
  .visiter
  {
    padding-right: 20px;
    text-align: center;
    border-right: 2px solid #b2a9aa;
    font-size: 0.9em;
  }
  .identity, .name
  {
    margin: 10px 0;
  }
  .identity img
  {
    height: 28px;
  }
  .userHead
  {
    width: 90px;
  }
  .messageConTd:after, .reply:after
  {
    margin-left: 10px;
    margin-top: 20px;
    content: " ";
    position: absolute;
    width: 100%;
    border-top: 2px solid #b2a9aa;
    color: #D9D9D9;
  }
  .messageConTd
  {
    padding-top: 10px;
    font-size: 0.8em;
  }
  .reply
  {
    font-size: 0.5em;
  }
  .messageCon, .replyTitle, .replyCon
  {
    margin-left: 30px;
  }
  .totalMessage
  {
    color: #da5050;
  }
  .pageBtn
  {
    margin: auto;
    align-self: center;
  }
  #page
  {
    margin: 10px;
  }
  .pageNum
  {
    padding: 5px;
    border: 1px gray solid;
  }
  #curPage
  {
    color: #da5050;
    border: none;
  }

```
test.js
```js
  $(function() {
    $.ajax({
      type: "get",
      url: '/back_db/leavemessageinfo/queryByMemId?member_id='+ '2',
      success: function(data){
        var totalMessage = parseInt(data.length);
        var content = '';
        var count = 1;
        $.each(data, function(i, message) {
          content +=
            '<div class="messageLi">' +
              '<div class="weui_cell liHeader">' +
                '<div class="weui_cell_hd weui_cell_primary">' +
                  '<span>主题: </span>' +
                  '<span class="mesTitle">' + message.title + '</span>' +
                '</div>' +
                '<div class="">' +
                  '<span><img src="/images/front_wechat/icon/mestime.png"> : </span>' +
                  '<span class="mesTime">' + message.leave_message_date + '</span>' +
                '</div>' +
              '</div>' +
              '<div class="weui_cell liContent">' +
                '<input type="hidden" class="leaveMessageId" value="' + message.leave_message_id + '">' +
                '<table>' +
                  '<tr>' +
                    '<td class="visiter" rowspan="2">' +
                      '<img class="userHead" src="' + message.member_image + '">' +
                      '<p class="identity">'+ '身份' +'</p>' +
                      '<p class="name">' + message.name + '</p>' +
                    '</td>' +
                    '<td class="messageConTd">' +
                      '<p class="messageCon">' + message.message_content + '</p>' +
                    '</td>' +
                  '</tr>' +
                  '<tr>' +
                    '<td class="reply">' +
                      '<p class="replyTitle">管理员[admin]回复: 2015-5-16 9:41:39</p>' +
                      '<p class="replyCon">感谢您的关注</p>' +
                    '</td>' +
                  '</tr>' +
                '</table>' +
              '</div>' +
            '</div>';
            if (i % 3 == 2) {
              localStorage.setItem('content['+count+']', content);
              count++;
              content = '';
            }
        });
        localStorage.setItem('content['+count+']', content);
        $("#messageUl").append(localStorage.getItem('content[0]'));
        $(".totalMessage")[0].innerHTML = totalMessage;
        var totalPage = parseInt(totalMessage / 3) + 1;
        var page = '';
        for (var i = 2; i <= totalPage; i++) {
          page += '<span class="pageNum">' + i + '</span>';
        }
        $("#totalPage").val(totalPage);
        $("#page").append(page);
      },
      error: function(data){
        console.log(data);
      }
    });
  /*

  */
    $("#newNote").click(function() {
      location.href = "writenote";
    });
    $("#prePage").click(function() {
      if($("#curPage")[0].innerHTML != "1") {
        //在这里，一开始没有使用变量element，直接就用$("#curPage"); 结果是，先设定了它前一个节点id=curPage，结果第二条语句获取的就是它的兄弟节点，而不是自己。
        var element = $("#curPage");
        element.prev().attr("id", 'curPage')
        element.attr("id", '');
        $("#messageUl").children().remove();
        $("#messageUl").append(localStorage.getItem('content[' + $("#curPage")[0].innerHTML + ']'));
      }
    });

    $("#nextPage").click(function() {
      if($("#curPage")[0].innerHTML != $("#totalPage").val()) {
        var element = $("#curPage");
        element.next().attr("id", 'curPage')
        element.attr("id", '');
        $("#messageUl").children().remove();
        $("#messageUl").append(localStorage.getItem('content[' + $("#curPage")[0].innerHTML + ']'));
      }
    });
  });
```
